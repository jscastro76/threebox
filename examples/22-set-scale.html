<!doctype html>
<head>
	<title>Threebox Object3D Example</title>
	<link href="https://api.mapbox.com/mapbox-gl-js/v2.2.0/mapbox-gl.css" rel="stylesheet">
	<script src="https://api.mapbox.com/mapbox-gl-js/v2.2.0/mapbox-gl.js"></script>
	<script src="../dist/threebox.js" type="text/javascript"></script>
	<link href="../dist/threebox.css" rel="stylesheet" />
	<script src="config.js"></script>
	<style>
		body, html {
			width: 100%;
			height: 100%;
			margin: 0;
		}

		#map {
			width: 100%;
			height: 100%;
		}

        .scale-group  {
            position: absolute;
            right: 0px;
            top: 0px;
        }
	</style>
</head>
<body>
    <div id='map' class='map'></div>
    <div class="scale-group">
        <button onclick="setScale(25)">Set Scale 25</button>
        <button onclick="setScale(50)">Set Scale 50</button>
    </div>
</body>
<script>

    if (!config) console.error("Config not set! Make a copy of 'config_template.js', add in your access token, and save the file as 'config.js'.");

    mapboxgl.accessToken = config.accessToken;
    var origin = [-122.4340, 37.7353, 0];

    var globalModel;

    var map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/light-v9',
        center: origin,
        zoom: 12.5,
        pitch: 60,
        bearing: 80,
        antialias: true
    });


    // we can add Threebox to mapbox to add built-in mouseover/mouseout and click behaviors
    window.tb = new Threebox(
        map,
        map.getCanvas().getContext('webgl'),
        {
            defaultLights: true,
        }
    );

    map.on('style.load', function () {
        map.addLayer({
            id: 'custom_layer',
            type: 'custom',
            renderingMode: '3d',
            onAdd: function (map, mbxContext) {

                var options = {
                    obj: './models/soldier.glb',
                    type: 'gltf',
                    scale: 25,
                    units: 'scene',
                    rotation: { x: 90, y: 0, z: 0 }, //default rotation
                    anchor: 'center'
                }

                tb.loadObj(options, function (model) {
                    let soldier = model.setCoords(origin);
                    globalModel = soldier;
                    tb.add(soldier);
                })

            },

            render: function (gl, matrix) {
                tb.update();
            }
        });

    });

    function setScale(scale) {
        globalModel.setScale(scale);
    }

</script>
</html>